name: Build & Publish docker

on:
  workflow_dispatch:
    inputs:
      pkg-version:
        type: string
        description: The version of the package
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    uses: FirelightFlagboy/gh-actions-workflows-docker-services/.github/workflows/docker-build-publish.yml@fa20b78c37834b0b275e8e57cadddd5e126d91ce
    permissions:
      contents: read
      # This is used to complete the identity challenge
      # with sigstore/fulcio when running outside of PRs.
      id-token: write
    with:
      docker-username: firelightflagbot
      pkg-version: ${{ inputs.pkg-version || '1.8.6.3946' }}
      platforms: linux/amd64,linux/arm64
      registry: docker.io
      tags: firelightflagbot/prowlarr
    secrets:
      docker-password: ${{ secrets.DOCKER_HUB_PAT }}
